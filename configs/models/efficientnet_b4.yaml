# EfficientNet-B4 Model Configuration
# Balanced model with higher capacity

model:
  name: efficientnet_b4
  architecture: efficientnet_b4
  pretrained: true
  num_classes: 7
  
  in_channels: 3
  features_only: false
  drop_rate: 0.3  # Higher dropout for larger model
  drop_path_rate: 0.3
  global_pool: avg

training:
  optimizer:
    type: adamw
    lr: 0.00005  # Lower LR for larger model
    weight_decay: 0.01
    betas: [0.9, 0.999]
    
  scheduler:
    type: cosine
    T_max: 100
    eta_min: 0.000001
    warmup_epochs: 5
    
  loss:
    type: cross_entropy
    label_smoothing: 0.1
    
  batch_size: 32
  num_epochs: 100
  gradient_clip: 1.0
  use_amp: true

augmentation:
  train:
    - RandomResizedCrop:
        size: 380  # B4 uses 380x380
        scale: [0.8, 1.0]
    - RandomHorizontalFlip:
        p: 0.5
    - RandomVerticalFlip:
        p: 0.5
    - RandomRotation:
        degrees: 15
    - ColorJitter:
        brightness: 0.2
        contrast: 0.2
        saturation: 0.2
        hue: 0.1
    - Normalize:
        mean: [0.485, 0.456, 0.406]
        std: [0.229, 0.224, 0.225]
        
  val:
    - Resize:
        size: 432
    - CenterCrop:
        size: 380
    - Normalize:
        mean: [0.485, 0.456, 0.406]
        std: [0.229, 0.224, 0.225]

capacity:
  parameters: 19341616  # ~19.3M parameters
  flops: 4207205376  # ~4.2 GFLOPs

tasks:
  dermoscopy:
    num_classes: 7
    batch_size: 32
    image_size: 380
    
  chest_xray:
    num_classes: 14
    batch_size: 16
    image_size: 380
    loss:
      type: bce_with_logits
      
  retinopathy:
    num_classes: 5
    batch_size: 32
    image_size: 380
